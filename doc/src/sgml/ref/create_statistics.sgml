<!--
doc/src/sgml/ref/create_statistics.sgml
PostgreSQL documentation
-->

<refentry id="SQL-CREATESTATISTICS">
 <indexterm zone="sql-createstatistics">
  <primary>CREATE STATISTICS</primary>
 </indexterm>

 <refmeta>
  <refentrytitle>CREATE STATISTICS</refentrytitle>
  <manvolnum>7</manvolnum>
  <refmiscinfo>SQL - Language Statements</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>CREATE STATISTICS</refname>
  <refpurpose>define a new statistics</refpurpose>
 </refnamediv>

 <refsynopsisdiv>
<synopsis>
CREATE STATISTICS [ IF NOT EXISTS ] <replaceable class="PARAMETER">statistics_name</replaceable> ON <replaceable class="PARAMETER">table_name</replaceable> ( [
  { <replaceable class="PARAMETER">column_name</replaceable> } ] [, ...])
[ WITH ( <replaceable class="PARAMETER">statistics_parameter</replaceable> [= <replaceable class="PARAMETER">value</replaceable>] [, ... ] )
</synopsis>

 </refsynopsisdiv>

 <refsect1 id="SQL-CREATESTATISTICS-description">
  <title>Description</title>

  <para>
   <command>CREATE STATISTICS</command> will create a new multivariate
   statistics on the table. The statistics will be created in the in the
   current database. The statistics will be owned by the user issuing
   the command.
  </para>

  <para>
   If a schema name is given (for example, <literal>CREATE STATISTICS
   myschema.mystat ...</>) then the statistics is created in the specified
   schema.  Otherwise it is created in the current schema.  The name of
   the table must be distinct from the name of any other statistics in the
   same schema.
  </para>

  <para>
   To be able to create a table, you must have <literal>USAGE</literal>
   privilege on all column types or the type in the <literal>OF</literal>
   clause, respectively.
  </para>
 </refsect1>

 <refsect1>
  <title>Parameters</title>

  <variablelist>

   <varlistentry>
    <term><literal>IF NOT EXISTS</></term>
    <listitem>
     <para>
      Do not throw an error if a statistics with the same name already exists.
      A notice is issued in this case.  Note that there is no guarantee that
      the existing statistics is anything like the one that would have been
      created.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><replaceable class="PARAMETER">statistics_name</replaceable></term>
    <listitem>
     <para>
      The name (optionally schema-qualified) of the statistics to be created.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><replaceable class="PARAMETER">table_name</replaceable></term>
    <listitem>
     <para>
      The name (optionally schema-qualified) of the table the statistics should
      be created on.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><replaceable class="PARAMETER">column_name</replaceable></term>
    <listitem>
     <para>
      The name of a column to be included in the statistics.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>WITH ( <replaceable class="PARAMETER">statistics_parameter</replaceable> [= <replaceable class="PARAMETER">value</replaceable>] [, ... ] )</literal></term>
    <listitem>
     <para>
      ...
     </para>
    </listitem>
   </varlistentry>

  </variablelist>

  <refsect2 id="SQL-CREATESTATISTICS-parameters">
   <title id="SQL-CREATESTATISTICS-parameters-title">Statistics Parameters</title>

 <indexterm zone="sql-createstatistics-parameters">
  <primary>statistics parameters</primary>
 </indexterm>

   <para>
    The <literal>WITH</> clause can specify <firstterm>statistics parameters</>
    for statistics. The currently available parameters are listed below.
   </para>

   <variablelist>

   <varlistentry>
    <term><literal>dependencies</> (<type>boolean</>)</term>
    <listitem>
     <para>
      Enables functional dependencies for the statistics.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>histogram</> (<type>boolean</>)</term>
    <listitem>
     <para>
      Enables histogram for the statistics.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>max_buckets</> (<type>integer</>)</term>
    <listitem>
     <para>
      Maximum number of histogram buckets.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>max_mcv_items</> (<type>integer</>)</term>
    <listitem>
     <para>
      Maximum number of MCV list items.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>mcv</> (<type>boolean</>)</term>
    <listitem>
     <para>
      Enables MCV list for the statistics.
     </para>
    </listitem>
   </varlistentry>

   </variablelist>

  </refsect2>
 </refsect1>

 <refsect1 id="SQL-CREATESTATISTICS-notes">
  <title>Notes</title>

    <para>
     ...
    </para>

 </refsect1>


 <refsect1 id="SQL-CREATESTATISTICS-examples">
  <title>Examples</title>

  <para>
   Create table <structname>t1</> with two functionally dependent columns, i.e.
   knowledge of a value in the first column is sufficient for detemining the
   value in the other column. Then functional dependencies are built on those
   columns:

<programlisting>
CREATE TABLE t1 (
    a   int,
    b   int
);

INSERT INTO t1 SELECT i/100, i/500
                 FROM generate_series(1,1000000) s(i);

CREATE STATISTICS s1 ON t1 (a, b) WITH (dependencies);

ANALYZE t1;

-- valid combination of values
EXPLAIN ANALYZE SELECT * FROM t1 WHERE (a = 1) AND (b = 1);

-- invalid combination of values
EXPLAIN ANALYZE SELECT * FROM t1 WHERE (a = 1) AND (b = 2);
</programlisting>
  </para>

  <para>
   Create table <structname>t2</> with two perfectly correlated columns
   (containing identical data), and a MCV list on those columns:

<programlisting>
CREATE TABLE t2 (
    a   int,
    b   int
);

INSERT INTO t2 SELECT mod(i,100), mod(i,100)
                 FROM generate_series(1,1000000) s(i);

CREATE STATISTICS s2 ON t2 (a, b) WITH (mcv);

ANALYZE t2;

-- valid combination (found in MCV)
EXPLAIN ANALYZE SELECT * FROM t2 WHERE (a = 1) AND (b = 1);

-- invalid combination (not found in MCV)
EXPLAIN ANALYZE SELECT * FROM t2 WHERE (a = 1) AND (b = 2);
</programlisting>
  </para>

  <para>
   Create table <structname>t3</> with two strongly correlated columns, and
   a histogram on those two columns:

<programlisting>
CREATE TABLE t3 (
    a   float,
    b   float
);

INSERT INTO t3 SELECT mod(i,1000), mod(i,1000) + 50 * (r - 0.5) FROM (
                   SELECT i, random() r FROM generate_series(1,1000000) s(i)
                 ) foo;

CREATE STATISTICS s3 ON t3 (a, b) WITH (histogram);

ANALYZE t2;

-- small overlap
EXPLAIN ANALYZE SELECT * FROM t3 WHERE (a < 500) AND (b > 500);

-- no overlap
EXPLAIN ANALYZE SELECT * FROM t3 WHERE (a < 400) AND (b > 600);
</programlisting>
  </para>

 </refsect1>

 <refsect1>
  <title>Compatibility</title>

  <para>
   There's no <command>CREATE STATISTICS</command> command in the SQL standard.
  </para>
 </refsect1>

 <refsect1>
  <title>See Also</title>

  <simplelist type="inline">
   <member><xref linkend="sql-alterstatistics"></member>
   <member><xref linkend="sql-dropstatistics"></member>
  </simplelist>
 </refsect1>
</refentry>
