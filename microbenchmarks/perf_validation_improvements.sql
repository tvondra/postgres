-- based on https://postgr.es/m/527571eb98b9bed54c8cadb261c14795@oss.nttdata.com

\pset pager off
set client_min_messages='notice';
set enable_seqscan=off;
DROP TABLE IF EXISTS t;
CREATE unlogged TABLE t (id1 int, id2 int);
INSERT INTO t (SELECT i, abs(hashint4(i::int4)) % 1_000_000 FROM generate_series(1,1_000_000) s(i));
CREATE INDEX t_idx on t (id1, id2);
VACUUM (FREEZE, VERBOSE, ANALYZE) t;
-- SET skipscan_prefix_cols=0;

\echo 'SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 = 1:'
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 = 1;
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 = 1;
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 = 1;
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 = 1;
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 = 1;
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 = 1;
EXPLAIN (ANALYZE, BUFFERS) SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 = 1;

\echo 'SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 = 1_000_000:'
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 = 1_000_000;
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 = 1_000_000;
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 = 1_000_000;
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 = 1_000_000;
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 = 1_000_000;
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 = 1_000_000;
EXPLAIN (ANALYZE, BUFFERS) SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 = 1_000_000;

\echo 'SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 IN (0, 1, 1_000_000):'
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 IN (0, 1, 1_000_000);
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 IN (0, 1, 1_000_000);
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 IN (0, 1, 1_000_000);
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 IN (0, 1, 1_000_000);
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 IN (0, 1, 1_000_000);
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 IN (0, 1, 1_000_000);
EXPLAIN (ANALYZE, BUFFERS) SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 IN (0, 1, 1_000_000);


\echo 'SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 <= 1:'
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 <= 1;
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 <= 1;
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 <= 1;
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 <= 1;
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 <= 1;
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 <= 1;
EXPLAIN (ANALYZE, BUFFERS) SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 <= 1;


\echo 'SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 between 1 AND 3:'
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 between 1 AND 3;
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 between 1 AND 3;
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 between 1 AND 3;
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 between 1 AND 3;
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 between 1 AND 3;
SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 between 1 AND 3;
EXPLAIN (ANALYZE, BUFFERS) SELECT * FROM t WHERE id1 BETWEEN 0 AND 1_000_000 AND id2 between 1 AND 3;
